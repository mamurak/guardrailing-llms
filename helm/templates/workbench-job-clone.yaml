{{- if and .Values.workbench.enabled .Values.workbench.gitRepo.enabled }}
---
apiVersion: batch/v1
kind: Job
metadata:
<<<<<<< HEAD
  name: {{ .Values.workbench.name }}-clone-repo
=======
  name: clone-guardrails-repo
>>>>>>> 1117c9c2e3b32a20d3e2f18936ee52905e04eaec
  namespace: {{ .Release.Namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "2"
    argocd.argoproj.io/hook: Sync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
spec:
  backoffLimit: 3
  template:
    spec:
      serviceAccountName: {{ .Values.workbench.name }}
      initContainers:
        - name: wait-for-workbench
          image: image-registry.openshift-image-registry.svc:5000/openshift/tools:latest
          command: ["/bin/bash"]
          args:
            - -ec
            - |
              echo "Waiting for workbench pod..."
<<<<<<< HEAD
              while [ -z "$(oc get pods -n {{ .Release.Namespace }} -l notebook-name={{ .Values.workbench.name }} -o jsonpath='{.items[0].status.phase}' 2>/dev/null | grep Running)" ]; do
=======
              while [ -z "$(oc get pods -n {{ .Release.Namespace }} -l notebook-name=guardrails-workbench -o jsonpath='{.items[0].status.phase}' 2>/dev/null | grep Running)" ]; do
>>>>>>> 1117c9c2e3b32a20d3e2f18936ee52905e04eaec
                sleep 2
              done
              echo "Workbench pod is running."
      containers:
        - name: git-clone
          image: image-registry.openshift-image-registry.svc:5000/openshift/tools:latest
          command: ["/bin/bash"]
          args:
            - -ec
            - |
<<<<<<< HEAD
              POD_NAME=$(oc get pods -n {{ .Release.Namespace }} -l notebook-name={{ .Values.workbench.name }} -o jsonpath='{.items[0].metadata.name}')
              oc exec -n {{ .Release.Namespace }} $POD_NAME -- bash -c "cd /opt/app-root/src && git clone {{ .Values.workbench.gitRepo.url }}"
=======
              POD_NAME=$(oc get pods -n {{ .Release.Namespace }} -l notebook-name=guardrails-workbench -o jsonpath='{.items[0].metadata.name}')
              oc exec -n {{ .Release.Namespace }} $POD_NAME -- bash -c "cd /opt/app-root/src && git clone https://github.com/rh-ai-quickstart/guardrailing-llms.git"
>>>>>>> 1117c9c2e3b32a20d3e2f18936ee52905e04eaec
      restartPolicy: Never
{{- end }}
